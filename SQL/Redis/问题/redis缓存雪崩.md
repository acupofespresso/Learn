# **redis**缓存雪崩
## 原因
* 原本应当由**redis**承担大部分用户查询的请求，避免请求全部落在数据库上
* 因**redis**缓存同一时间大量失效等原因，导致所有请求瞬间落在数据库上，使数据库扛不住压力崩溃， 用户所有的请求都超时报错。

## 解决
1. 首先通过API Gateway（网关）限制大部分流量进来 
2. 接着将宕机的数据库服务重启 
3. 再重新预热缓存 

## 避免
* 均衡过期
    * 设置不同的过期时间，让缓存失效的时间点尽量均匀。通常可以为有效期增加随机值或者统一规划有效期。
* 加互斥锁
    * 跟缓存击穿解决思路一致，同一时间只让一个线程构建缓存，其他线程阻塞排队。
* 缓存永不过期
    * 跟缓存击穿解决思路一致，缓存在物理上永远不过期，用一个异步的线程更新缓存。